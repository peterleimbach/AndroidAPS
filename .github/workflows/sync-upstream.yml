name: Build AndroidAPS

on:
  schedule:
    - cron:  '0 7 * * 1'
    # scheduled at 07:00 every Monday

  workflow_dispatch:  # click the button on Github repo!


jobs:
  sync_with_upstream:
    runs-on: ubuntu-latest
    name: Sync main with upstream latest

    steps:
    - name: Checkout main
      uses: actions/checkout@v2
      with:
        ref: master

    - name: Use Java11
#      uses: actions/setup-java@v1
#      with:
#        java-version: 1.11
        
      uses: AdoptOpenJDK/install-jdk@v1
      with:
        version: '11'
        architecture: x64
    
    - name: Install NDK
      run: echo "y" | sudo ${ANDROID_HOME}/tools/bin/sdkmanager --install "ndk;21.1.6352462" --sdk_root=${ANDROID_SDK_ROOT}

    - name: Build release apk
      run: ./gradlew :app:assembleFullRelease --stacktrace
    
    - name: List files build
      run: |
        cd app/build/outputs
        ls -LR
